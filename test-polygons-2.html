<!DOCTYPE html>
<html>
<head>
    <title>Google Maps with Dynamic Polygons and Markers</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=<API_KEY>&callback=initMap" async defer></script>
    <script>
        let map;

        function initMap() {
            // Creare la mappa centrata sull'Italia
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 5,
                center: { lat: 41.8719, lng: 12.5674 } // Centro approssimativo dell'Italia
            });

            document.getElementById('polygonInput').value = `POLYGON((16.53483785734516 38.79459515585769,19.56871031103599 38.31254274685524,19.568710311036 40.85807948120362,16.53483785734516 41.34803119841404,16.53483785734516 38.79459515585769))
POLYGON((13.54369133221138 36.52130173970455,16.53483785734516 36.1376398719511,16.53483785734516 38.79459515585769,13.54369133221139 39.18771697563789,13.54369133221138 36.52130173970455))`;

            document.getElementById('pointInput').value = `37.242460,15.245186
41.30859375,16.875`;

        }

        function addPolygon() {
            const input = document.getElementById('polygonInput').value;
            if (!input) return;

            //const convertedInput = convertPolygons(input);

            //const coordsArray = JSON.parse(convertedInput);
            const coordsArray = convertPolygons(input);
            console.log(coordsArray);

            const polygon = new google.maps.Polygon({
                paths: coordsArray,
                strokeColor: '#FF0000',
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: '#FF0000',
                fillOpacity: 0.35
            });
            polygon.setMap(map);
        }

        function convertPolygons(polygonString) {
            // Split the input string by lines and filter out empty lines
            const lines = polygonString.trim().split('\n').filter(line => line.trim() !== '');

            // Function to parse a POLYGON string
            function parsePolygon(polygonStr) {
                // Remove the "POLYGON((" prefix and "))" suffix
                const coordsStr = polygonStr.replace('POLYGON((', '').replace('))', '');

                console.log(coordsStr);

                // Split the coordinates string into an array of coordinate pairs
                const coordsPairs = coordsStr.split(',');

                // Map the coordinate pairs to an array of {lat, lng} objects
                return coordsPairs.map(pair => {
                    const [lng, lat] = pair.trim().split(' ').map(Number);
                    return { lat: lat, lng: lng };
                });
            }

        // Convert each line to a polygon array
        return lines.map(line => parsePolygon(line));
        }

        function addPoints() {
            const input = document.getElementById('pointInput').value;
            if (!input) return;

            const lines = input.trim().split('\n').filter(line => line.trim() !== '');
            console.log(lines);

            const points = lines.map(pair => {
                const [lat, lng] = pair.trim().split(',').map(Number);
                return {lat: lat, lng: lng}
            });

            points.forEach(point => {
                new google.maps.Marker({
                    position: point,
                    map: map
                });
            });
        }
    </script>
    <style>
        /* Stili per la mappa */
        #map {
            height: 80%;
            width: 100%;
        }

        /* Assicurarsi che il body e l'html abbiano l'altezza e la larghezza del 100% */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .controls {
            height: 20%;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="controls" style="float:left;">
        <textarea id="polygonInput" rows="4" cols="50" placeholder='Inserisci poligoni'></textarea>
        <br>
        <button onclick="addPolygon()">Aggiungi Poligono</button>
    </div>
    <div class="controls">
        <textarea id="pointInput" rows="4" cols="50" placeholder='Inserisci coordinate'></textarea>
        <br>
        <button onclick="addPoints()">Aggiungi Linea</button>
    </div>
</body>
</html>
